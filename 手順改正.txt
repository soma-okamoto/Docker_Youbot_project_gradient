

# 1) Docker_ReachabilityMapターミナル
cd Docker_ReachabilityMap
docker rm -f ros_dev
docker run -d --name ros_dev -p 9090:9090 -v C:\Users\soma0\Docker_ReachabilityMap:/root ros_dev tail -f /dev/null

docker exec -it ros_dev bash

# 1) Esaki_youbootターミナル
cd Esaki_youboot
docker rm -f esaki_youbot
docker run -d --name esaki_youbot -p 9092:9090 -v C:\Users\soma0\Esaki_youboot:/root esaki_youbot tail -f /dev/null

docker exec -it esaki_youbot bash


#手順
Ubuntuのターミナルで
# 1) youboot_simターミナル
docker rm -f youbot_ros 2>/dev/null
docker run --gpus all -d --name youbot_ros \
  -e DISPLAY=$DISPLAY \
  -e WAYLAND_DISPLAY=$WAYLAND_DISPLAY \
  -e XDG_RUNTIME_DIR=$XDG_RUNTIME_DIR \
  -e PULSE_SERVER=${PULSE_SERVER:-unix:${XDG_RUNTIME_DIR}/pulse/native} \
  -v /tmp/.X11-unix:/tmp/.X11-unix \
  -v $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY:$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY \
  -v $XDG_RUNTIME_DIR/pulse:$XDG_RUNTIME_DIR/pulse \
  -v /mnt/wslg:/mnt/wslg \
  -v /usr/lib/wsl:/usr/lib/wsl:ro \
  -e LD_LIBRARY_PATH=/usr/lib/wsl/lib \
  youbot_ros tail -f /dev/null

docker exec -it youbot_ros bash


# 実行（WSLg 連携）
docker rm -f gazebo_dev 2>/dev/null
docker run --gpus all -d --name gazebo_dev \
  -e DISPLAY=$DISPLAY \
  -e WAYLAND_DISPLAY=$WAYLAND_DISPLAY \
  -e XDG_RUNTIME_DIR=$XDG_RUNTIME_DIR \
  -e PULSE_SERVER=${PULSE_SERVER:-unix:${XDG_RUNTIME_DIR}/pulse/native} \
  -v /tmp/.X11-unix:/tmp/.X11-unix \
  -v $XDG_RUNTIME_DIR/$WAYLAND_DISPLAY:$XDG_RUNTIME_DIR/$WAYLAND_DISPLAY \
  -v $XDG_RUNTIME_DIR/pulse:$XDG_RUNTIME_DIR/pulse \
  -v /mnt/wslg:/mnt/wslg \
  -v /usr/lib/wsl:/usr/lib/wsl:ro \
  -v "$HOME/edit_gazebo":/root \
  -e LD_LIBRARY_PATH=/usr/lib/wsl/lib \
  gazebo_dev tail -f /dev/null

docker exec -it gazebo_dev bash




#########################################################

docker network create rosnet

docker network connect rosnet ros_dev
docker network connect rosnet youbot_ros
docker network connect rosnet esaki_youbot
docker network connect rosnet gazebo_dev


#########################################################



# 2) Docker_ReachabilityMapターミナル
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=ros_dev 
source /opt/ros/noetic/setup.bash
roslaunch rosbridge_server rosbridge_websocket.launch


cd RM
source devel/setup.bash
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=ros_dev 

roslaunch sampled_reachability_maps MR_IRM_generate_Docker.launch
rosrun sampled_reachability_maps MR_IRM_firstRoute_fixed.py

cd Detect_ws
source devel/setup.bash
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=ros_dev 

rosrun detect_pkg DetectTarget.py \
  --win=0.5,0.25,0.25 \
  --wout=0.21,0.58,0.21

rosrun detect_pkg Bottle_info_Save_to_CSV.py



# 2) Esaki_youbootターミナル
cd catkin_ws
source /opt/ros/noetic/setup.bash
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=esaki_youbot
source devel/setup.bash

rosrun esaki_youbot_project_gradient youbot_real_trajectory_node.py
rosrun esaki_youbot_project_gradient youbot_real_recover_trajectory.py
rosrun esaki_youbot_project_gradient Bridge_Simulation_command.py

rosrun esaki_youbot_project_gradient Bridge_Simulation_gripper.py
rosrun esaki_youbot_project_gradient gripper.py


roslaunch esaki_slam youbot_move_base.launch
roslaunch slam_toolbox online_async.launch 

rosrun esaki_youbot_project_gradient Origin_move_pub.py 

rosrun esaki_youbot_project_gradient IRM_youbot_baseMove.py

# 2) youboot_simターミナル
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=youbot_ros 
source /opt/ros/noetic/setup.bash
source /root/catkin_ws/devel/setup.bash



FILE=$(rospack find youbot_description)/urdf/youbot_arm/arm.urdf.xacro
cp "$FILE" "${FILE}.bak"
perl -0777 -pe '
  s#(<joint name="\$\{name\}_joint_1".*?<dynamics )damping="[^"]+" friction="[^"]+"#${1}damping="0.0" friction="0.0"#s;
  s#(<joint name="\$\{name\}_joint_1".*?<limit )effort="[^"]+"#${1}effort="120"#s;
' -i "$FILE"


grep -rl 'xacro.py' ~/catkin_ws/src | grep '\.launch' | xargs sed -i 's#$(find xacro)/xacro.py#$(find xacro)/xacro#g'

roslaunch youbot_gazebo_robot youbot.launch
roslaunch youbot_gazebo_robot youbot_dual_arm.launch
roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=empty_world
roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=tower_of_hanoi
roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=boxed_walls_10x10

rosrun rviz rviz

# 2) gazeboターミナル
export ROS_MASTER_URI=http://ros_dev:11311
export ROS_HOSTNAME=gazebo_dev 
source /opt/ros/noetic/setup.bash
source /root/devel/setup.bash

grep -rl 'xacro.py' ~/src | grep '\.launch' | xargs sed -i 's#$(find xacro)/xacro.py#$(find xacro)/xacro#g'

roslaunch youbot_gazebo_robot youbot_dual_arm.launch

roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=empty_world
roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=tower_of_hanoi
roslaunch youbot_gazebo_robot youbot_dual_arm.launch world:=robocup_at_work_2012
